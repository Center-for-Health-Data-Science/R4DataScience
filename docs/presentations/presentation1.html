<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Presentation 1: Data Cleaning – R for Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">R for Data Science</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Course Material</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about_heads.html"> 
<span class="menu-text">About us</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../presentations/presentation1.html">Presentations</a></li><li class="breadcrumb-item"><a href="../presentations/presentation1.html">Presentation 1: Data Cleaning</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/R4datascience_slides.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slides️</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Presentations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../presentations/presentation1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Presentation 1: Data Cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../presentations/presentation2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation 2: Summary Statistics and Data Wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../presentations/presentation3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation 3: Exploratory Data Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../presentations/presentation4A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation 4A: Conditions and For-loops</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../presentations/presentation4B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation 4B: Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../presentations/presentation5A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation 5A: Intro to Regression in R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../presentations/presentation5B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation 5B: Models and Model Evaluation in R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../data/data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data️</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Exercises</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 0: R script and Quarto</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 1: Data Cleaning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 2: Summary Statistics and Data Wrangling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 3: Exploratory Data Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise4A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 4A: Conditions and For-loops</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise4B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 4B: Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise5A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 5A: Intro to Regression in R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exercises/exercise5B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 5B: Models and Model Evaluation in R</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Cheat Sheets</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CheatSheet/quartoCheatSheet.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CheatSheet/BaseRCheatSheet.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Base R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CheatSheet/TidyverseCheatSheet.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tidyverse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CheatSheet/ggplotCheatSheet.pdf" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ggplot2</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link active" data-scroll-target="#load-packages">Load Packages</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#understanding-the-data" id="toc-understanding-the-data" class="nav-link" data-scroll-target="#understanding-the-data">Understanding the Data</a>
  <ul class="collapse">
  <li><a href="#basics" id="toc-basics" class="nav-link" data-scroll-target="#basics">Basics</a></li>
  </ul></li>
  <li><a href="#data-wrangling-and-cleaning" id="toc-data-wrangling-and-cleaning" class="nav-link" data-scroll-target="#data-wrangling-and-cleaning">Data wrangling and cleaning</a>
  <ul class="collapse">
  <li><a href="#step-1-drop-variables-with-too-many-missing-values" id="toc-step-1-drop-variables-with-too-many-missing-values" class="nav-link" data-scroll-target="#step-1-drop-variables-with-too-many-missing-values">Step 1: Drop Variables with Too Many Missing Values</a></li>
  <li><a href="#step-2-fix-variable-types" id="toc-step-2-fix-variable-types" class="nav-link" data-scroll-target="#step-2-fix-variable-types">Step 2: Fix Variable Types</a></li>
  <li><a href="#step-3-drop-non-informative-variables" id="toc-step-3-drop-non-informative-variables" class="nav-link" data-scroll-target="#step-3-drop-non-informative-variables">Step 3: Drop Non-Informative Variables</a></li>
  <li><a href="#step-4-re-code-and-reorder-factors" id="toc-step-4-re-code-and-reorder-factors" class="nav-link" data-scroll-target="#step-4-re-code-and-reorder-factors">Step 4: Re-code and Reorder Factors</a></li>
  </ul></li>
  <li><a href="#create-new-variables" id="toc-create-new-variables" class="nav-link" data-scroll-target="#create-new-variables">Create New Variables</a>
  <ul class="collapse">
  <li><a href="#step-5-creating-new-variables" id="toc-step-5-creating-new-variables" class="nav-link" data-scroll-target="#step-5-creating-new-variables">Step 5: Creating New Variables</a></li>
  </ul></li>
  <li><a href="#string-manipulation" id="toc-string-manipulation" class="nav-link" data-scroll-target="#string-manipulation">String manipulation</a>
  <ul class="collapse">
  <li><a href="#regex-regular-expression" id="toc-regex-regular-expression" class="nav-link" data-scroll-target="#regex-regular-expression">Regex: Regular expression</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  </ul></li>
  <li><a href="#joining-dataframes" id="toc-joining-dataframes" class="nav-link" data-scroll-target="#joining-dataframes">Joining Dataframes</a>
  <ul class="collapse">
  <li><a href="#lets-join-our-datasets" id="toc-lets-join-our-datasets" class="nav-link" data-scroll-target="#lets-join-our-datasets">Let’s join our datasets</a></li>
  <li><a href="#recap" id="toc-recap" class="nav-link" data-scroll-target="#recap">Recap</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../presentations/presentation1.html">Presentations</a></li><li class="breadcrumb-item"><a href="../presentations/presentation1.html">Presentation 1: Data Cleaning</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Presentation 1: Data Cleaning</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this section, we’ll focus on cleaning a dataset. We’ll primarily use functions from the <code>tidyverse</code> package, but in some cases base R offers quick and effective alternatives.</p>
<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># unload MASS since it has select function we don't want to use. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load data</h2>
<p>We’ll work with two datasets:</p>
<ul>
<li><p><code>df_ov</code>: clinical information for ovarian cancer patients.</p></li>
<li><p><code>df_exp</code>: gene expression data for cytochrome genes.</p></li>
</ul>
<p>We use the <code>load()</code> function, which automatically imports an R object - let’s have a look at it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/Ovarian_data.RData"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(df_ov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_ov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 578  22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="sc">%&gt;%</span> <span class="fu">head</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 22
  alt_sample_name    unique_patient_ID sample_type histological_type primarysite
  &lt;chr&gt;              &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;             &lt;chr&gt;      
1 TCGA-20-0987-01A-… TCGA-20-0987      tumor       ser               ov         
2 TCGA-23-1031-01A-… TCGA-23-1031      tumor       ser               ov         
3 TCGA-24-0979-01A-… TCGA-24-0979      tumor       ser               ov         
4 TCGA-23-1117-01A-… TCGA-23-1117      tumor       ser               ov         
5 TCGA-23-1021-01B-… TCGA-23-1021      tumor       ser               ov         
6 TCGA-04-1337-01A-… TCGA-04-1337      tumor       ser               ov         
# ℹ 17 more variables: arrayedsite &lt;lgl&gt;, summarygrade &lt;chr&gt;,
#   summarystage &lt;chr&gt;, tumorstage &lt;int&gt;, grade &lt;int&gt;,
#   age_at_initial_path_diagn &lt;int&gt;, recurrence_status &lt;chr&gt;,
#   days_to_death &lt;int&gt;, vital_status &lt;chr&gt;, os_binary &lt;lgl&gt;,
#   relapse_binary &lt;lgl&gt;, site_of_tumor_first_recurrence &lt;chr&gt;,
#   primary_therapy_outcome_success &lt;chr&gt;, percent_normal_cells &lt;int&gt;,
#   percent_stromal_cells &lt;int&gt;, percent_tumor_cells &lt;int&gt;, batch &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(df_exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 578  12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_exp <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 12
  unique_patient_ID CXCL1 CXCL10 CXCL11 CXCL12 CXCL13 CXCL14 CXCL2 CXCL3 CXCL5
  &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 TCGA-20-0987       4.97   9.91   5.26   5.44   6.55   3.07  5.14  3.72  3.31
2 TCGA-23-1031       3.99   6.61   2.90   6.31   3.18   2.71  5.12  3.76  3.11
3 TCGA-24-0979       3.87  10.0    4.19   4.19   3.36   2.77  7.28  3.88  3.38
4 TCGA-23-1117       3.16   9.24   3.89   9.07   5.10   6.20  5.88  3.50  3.04
5 TCGA-23-1021       3.35   7.86   2.95   5.10   3.41   5.13  5.50  3.69  2.97
6 TCGA-04-1337       6.61   8.41   3.53   6.70   3.91   7.37  6.26  3.56  2.80
# ℹ 2 more variables: CXCL6 &lt;dbl&gt;, CXCL9 &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="understanding-the-data" class="level2">
<h2 class="anchored" data-anchor-id="understanding-the-data">Understanding the Data</h2>
<p>Before jumping into statistics or modeling, we need to think about what scientific question we are trying to answer and get an understanding of the dataset we are working with.</p>
<ul>
<li><p>What does each column (variable) represent?</p></li>
<li><p>Are the values <strong>numeric</strong>, <strong>categorical</strong>, <strong>character</strong>, or something else?</p></li>
<li><p>Are there any <strong>missing values</strong>, or other data quality issues?</p></li>
<li><p>Are there <strong>domain-specific rules</strong> (e.g., medical standards)?</p></li>
</ul>
<p>This will help us get an overview of the data, help you avoid mistakes, and choose the right analysis methods.</p>
<section id="basics" class="level3">
<h3 class="anchored" data-anchor-id="basics">Basics</h3>
<p>We can get a little reminder of base R and tidyverse functions and explore some basic data characteristics.</p>
<p>Take a look at categorical and numerical variables, access elements in list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># output: vector</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df_ov<span class="sc">$</span>vital_status <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "deceased" "deceased" "deceased" "deceased" "deceased" "deceased"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># output: one-column-tibble </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df_ov <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vital_status) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  vital_status
  &lt;chr&gt;       
1 deceased    
2 deceased    
3 deceased    
4 deceased    
5 deceased    
6 deceased    </code></pre>
</div>
</div>
<p>Get a vector the tidyverse way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vital_status) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "deceased" "deceased" "deceased" "deceased" "deceased" "deceased"</code></pre>
</div>
</div>
<section id="check-for-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="check-for-missing-values">Check for Missing Values</h4>
<p>Check which columns contain NA values and how many:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colSums</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                alt_sample_name               unique_patient_ID 
                              1                               0 
                    sample_type               histological_type 
                              0                              10 
                    primarysite                     arrayedsite 
                             10                             578 
                   summarygrade                    summarystage 
                             23                              15 
                     tumorstage                           grade 
                             15                              23 
      age_at_initial_path_diagn               recurrence_status 
                             10                               0 
                  days_to_death                    vital_status 
                             21                              18 
                      os_binary                  relapse_binary 
                            578                             578 
 site_of_tumor_first_recurrence primary_therapy_outcome_success 
                            279                             124 
           percent_normal_cells           percent_stromal_cells 
                             19                              25 
            percent_tumor_cells                           batch 
                             22                               1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#%&gt;% barplot(las=2, cex.names=0.6) # baseR barplot since we are plotting a vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove rows with missing data (careful - this can reduce sample size too much):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 22
# ℹ 22 variables: alt_sample_name &lt;chr&gt;, unique_patient_ID &lt;chr&gt;,
#   sample_type &lt;chr&gt;, histological_type &lt;chr&gt;, primarysite &lt;chr&gt;,
#   arrayedsite &lt;lgl&gt;, summarygrade &lt;chr&gt;, summarystage &lt;chr&gt;,
#   tumorstage &lt;int&gt;, grade &lt;int&gt;, age_at_initial_path_diagn &lt;int&gt;,
#   recurrence_status &lt;chr&gt;, days_to_death &lt;int&gt;, vital_status &lt;chr&gt;,
#   os_binary &lt;lgl&gt;, relapse_binary &lt;lgl&gt;,
#   site_of_tumor_first_recurrence &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
<section id="check-groups-of-categorical-variables" class="level4">
<h4 class="anchored" data-anchor-id="check-groups-of-categorical-variables">Check groups of categorical variables</h4>
<p>Counting the number of occurrences for each level of a categorical variable.</p>
<p>Here we count how many dead or alive individuals we have. This is useful for checking balance across groups or categories.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(vital_status) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(<span class="at">useNA =</span> <span class="st">'ifany'</span>) <span class="co">#%&gt;% </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>vital_status
 deceased deceased     living   living       &lt;NA&gt; 
      281         9       259        11        18 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># barplot()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looks like we have two groups of deceased and living. Let’s have a closer look at the unique values of this variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df_ov<span class="sc">$</span>vital_status <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "deceased"  "living"    "deceased " "living "   NA         </code></pre>
</div>
</div>
<p>Whitespace includes spaces, newlines, and other blank characters in text. It can cause errors or inconsistencies in data, so removing unnecessary whitespace is an important step in cleaning data. Sometimes, hidden characters or spaces cause misgrouped levels.</p>
<p>Use the <code>str_trim()</code> function to remove whitespace.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(<span class="st">" Hello World!   "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello World!"</code></pre>
</div>
</div>
<p>Trim whitespace and standardize:</p>
<p>Like other function, the <code>str_trim()</code> function can also be used inside the <code>mutate()</code> function to alter the data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">vital_status =</span> <span class="fu">str_trim</span>(vital_status))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Accessing the unique values of the <code>vital_status</code> column. After clean up we only have one group of deceased and living - perfect!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_ov<span class="sc">$</span>vital_status <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "deceased" "living"   NA        </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="data-wrangling-and-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling-and-cleaning">Data wrangling and cleaning</h2>
<p><strong>Let’s do some cleanup</strong></p>
<ol type="1">
<li><p>Drop Variables with Too Many Missing Values</p></li>
<li><p>Fix Variable Types</p></li>
<li><p>Drop Non-Informative Variables</p></li>
<li><p>Recode and Reorder Factors</p></li>
<li><p>Create New Variables from existing ones</p></li>
</ol>
<section id="step-1-drop-variables-with-too-many-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="step-1-drop-variables-with-too-many-missing-values">Step 1: Drop Variables with Too Many Missing Values</h3>
<ol type="1">
<li>If a variable has more than ~10/30% missing data, it probably won’t be useful. Let’s remove those:</li>
</ol>
<p><code>~ mean(is.na(.)) &lt; threshold</code> explained: <code>~</code> = “Define a function” <code>.</code> is a placeholder for the input (in this case, a column of the data frame) <code>mean(is.na(.))</code> calculates the proportion of missing values <code>&lt; threshold</code> returns TRUE or FALSE — which where() uses to decide if a column should be kept</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fl">0.2</span> <span class="co"># 20% threshold</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span><span class="fu">mean</span>(<span class="fu">is.na</span>(.)) <span class="sc">&lt;</span> threshold))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_ov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 17
  alt_sample_name    unique_patient_ID sample_type histological_type primarysite
  &lt;chr&gt;              &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;             &lt;chr&gt;      
1 TCGA-20-0987-01A-… TCGA-20-0987      tumor       ser               ov         
2 TCGA-23-1031-01A-… TCGA-23-1031      tumor       ser               ov         
3 TCGA-24-0979-01A-… TCGA-24-0979      tumor       ser               ov         
4 TCGA-23-1117-01A-… TCGA-23-1117      tumor       ser               ov         
5 TCGA-23-1021-01B-… TCGA-23-1021      tumor       ser               ov         
6 TCGA-04-1337-01A-… TCGA-04-1337      tumor       ser               ov         
# ℹ 12 more variables: summarygrade &lt;chr&gt;, summarystage &lt;chr&gt;,
#   tumorstage &lt;int&gt;, grade &lt;int&gt;, age_at_initial_path_diagn &lt;int&gt;,
#   recurrence_status &lt;chr&gt;, days_to_death &lt;int&gt;, vital_status &lt;chr&gt;,
#   percent_normal_cells &lt;int&gt;, percent_stromal_cells &lt;int&gt;,
#   percent_tumor_cells &lt;int&gt;, batch &lt;int&gt;</code></pre>
</div>
</div>
<p>This keeps only the variables that are mostly complete.</p>
</section>
<section id="step-2-fix-variable-types" class="level3">
<h3 class="anchored" data-anchor-id="step-2-fix-variable-types">Step 2: Fix Variable Types</h3>
<p>Some variables are stored as <strong>character</strong> or <strong>numeric</strong> when they should actually be <strong>factors</strong> (i.e., categorical variables). Convert character/numeric columns to factors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One by one...</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>df_ov<span class="sc">$</span>sample_type <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df_ov<span class="sc">$</span>sample_type)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>df_ov<span class="sc">$</span>primarysite <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df_ov<span class="sc">$</span>primarysite)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># In one go:</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>cols_to_factor <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'sample_type'</span>, <span class="st">'primarysite'</span>, <span class="st">'summarygrade'</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'summarystage'</span>, <span class="st">'recurrence_status'</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'vital_status'</span>, <span class="st">'tumorstage'</span>, <span class="st">'grade'</span>, <span class="st">'batch'</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">all_of</span>(cols_to_factor), </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> as.factor))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df_ov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [578 × 17] (S3: tbl_df/tbl/data.frame)
 $ alt_sample_name          : chr [1:578] "TCGA-20-0987-01A-02R-0434-01" "TCGA-23-1031-01A-01R-0434-01" "TCGA-24-0979-01A-01R-0434-01" "TCGA-23-1117-01A-02R-0434-01" ...
 $ unique_patient_ID        : chr [1:578] "TCGA-20-0987" "TCGA-23-1031" "TCGA-24-0979" "TCGA-23-1117" ...
 $ sample_type              : Factor w/ 3 levels "healthy","tumor",..: 2 2 2 2 2 2 2 2 2 2 ...
 $ histological_type        : chr [1:578] "ser" "ser" "ser" "ser" ...
 $ primarysite              : Factor w/ 2 levels "other","ov": 2 2 2 2 2 2 2 2 2 2 ...
 $ summarygrade             : Factor w/ 4 levels "HIGH","high",..: 2 2 2 2 2 3 2 2 2 2 ...
 $ summarystage             : Factor w/ 2 levels "early","late": 2 2 2 2 2 2 2 2 2 2 ...
 $ tumorstage               : Factor w/ 4 levels "1","2","3","4": 3 4 4 3 4 3 3 4 3 3 ...
 $ grade                    : Factor w/ 4 levels "1","2","3","4": 3 3 3 3 3 2 3 3 3 3 ...
 $ age_at_initial_path_diagn: int [1:578] 61 60 53 42 45 78 74 73 45 45 ...
 $ recurrence_status        : Factor w/ 2 levels "norecurrence",..: 2 1 2 2 1 1 2 1 1 2 ...
 $ days_to_death            : int [1:578] 701 574 1264 1013 1446 61 789 84 2616 816 ...
 $ vital_status             : Factor w/ 2 levels "deceased","living": 1 1 1 1 1 1 2 1 2 2 ...
 $ percent_normal_cells     : int [1:578] 16 8 0 0 0 0 12 15 NA 0 ...
 $ percent_stromal_cells    : int [1:578] 1 5 25 NA 0 36 2 5 NA NA ...
 $ percent_tumor_cells      : int [1:578] 72 80 72 NA NA 64 84 72 NA NA ...
 $ batch                    : Factor w/ 14 levels "9","11","12",..: 3 3 3 3 3 3 3 3 3 3 ...</code></pre>
</div>
</div>
</section>
<section id="step-3-drop-non-informative-variables" class="level3">
<h3 class="anchored" data-anchor-id="step-3-drop-non-informative-variables">Step 3: Drop Non-Informative Variables</h3>
<p>Let’s check a few categorical variables and remove any that are redundant or irrelevant. If they don’t provide useful or well-curated information, we can drop them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df_ov<span class="sc">$</span>histological_type <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
ser 
568 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_ov<span class="sc">$</span>primarysite <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
other    ov 
    4   564 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"histological_type"</span>, <span class="st">"primarysite"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-4-re-code-and-reorder-factors" class="level3">
<h3 class="anchored" data-anchor-id="step-4-re-code-and-reorder-factors">Step 4: Re-code and Reorder Factors</h3>
<p>Sometimes we want to <strong>set the order of factor levels manually</strong>, especially if there’s a natural or meaningful order (e.g., “low” → “high”): This helps when plotting or interpreting regression coefficients.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary grade</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>df_ov<span class="sc">$</span>summarygrade <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
HIGH high  LOW  low 
  24  456    5   70 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">summarygrade =</span> <span class="fu">fct_recode</span>(summarygrade, <span class="st">"high"</span> <span class="ot">=</span> <span class="st">"HIGH"</span>),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">summarygrade =</span> <span class="fu">fct_recode</span>(summarygrade, <span class="st">"low"</span> <span class="ot">=</span> <span class="st">"LOW"</span>)) </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>df_ov<span class="sc">$</span>summarygrade <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
high  low 
 480   75 </code></pre>
</div>
</div>
</section>
</section>
<section id="create-new-variables" class="level2">
<h2 class="anchored" data-anchor-id="create-new-variables">Create New Variables</h2>
<p>Now, we would like to create a new data column by extracting specific information or combining other columns.</p>
<section id="step-5-creating-new-variables" class="level3">
<h3 class="anchored" data-anchor-id="step-5-creating-new-variables">Step 5: Creating New Variables</h3>
<p>Add a column combining other columns into one:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent_not_cancer_cells =</span> percent_stromal_cells <span class="sc">+</span> percent_normal_cells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For character vectors you can use functions <code>paste</code> and <code>paste0</code> . The <code>paste</code> function concatenates two strings into one. This one is from baseR.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">'TCGA'</span>, <span class="st">'Data'</span>, <span class="at">sep =</span> <span class="st">' '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TCGA Data"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">paste</span>(tumorstage, summarygrade, <span class="at">sep =</span> <span class="st">'-'</span>))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_ov<span class="sc">$</span>stage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3-high" "4-high" "4-high" "3-high" "4-high" "3-low" </code></pre>
</div>
</div>
<p>Create logical variables with <code>ifelse</code>. Adding a column with content based on a condition with <code>ifelse</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dominant_cell_type =</span> <span class="fu">ifelse</span>(percent_not_cancer_cells <span class="sc">&gt;</span> percent_tumor_cells, <span class="st">"not_cancer_cells"</span>, <span class="st">"cancer_cells"</span>))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df_ov<span class="sc">$</span>dominant_cell_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    cancer_cells not_cancer_cells 
             536                9 </code></pre>
</div>
</div>
<p>Extension of <code>ifelse</code>: <code>case_when</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(age_at_initial_path_diagn <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">&amp;</span> summarystage <span class="sc">==</span> <span class="st">"early"</span> <span class="sc">~</span> <span class="st">"Early stage - Young"</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                           age_at_initial_path_diagn <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">&amp;</span> summarystage <span class="sc">==</span> <span class="st">"late"</span> <span class="sc">~</span> <span class="st">"Late stage - Young"</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                           age_at_initial_path_diagn <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> summarystage <span class="sc">==</span> <span class="st">"early"</span> <span class="sc">~</span> <span class="st">"Early stage - Mature"</span>,</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                           age_at_initial_path_diagn <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> summarystage <span class="sc">==</span> <span class="st">"late"</span> <span class="sc">~</span> <span class="st">"Late stage - Mature"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">.default =</span> <span class="cn">NA</span>))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df_ov<span class="sc">$</span>group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Early stage - Mature  Early stage - Young  Late stage - Mature 
                  21                   22                  245 
  Late stage - Young 
                 275 </code></pre>
</div>
</div>
</section>
</section>
<section id="string-manipulation" class="level2">
<h2 class="anchored" data-anchor-id="string-manipulation">String manipulation</h2>
<p>Sometimes the information you need is hidden inside longer text strings or encoded in specific patterns — especially in genomics or clinical datasets. In this example we notice that sample type information is unknown for a lot of patients. Since we are TCGA experts, we know that this information is actually encoded in the full sample name <code>TCGA-20-0987-01A-02R-0434-01</code>. But How do we get it out.</p>
<p>To extract and work with this kind of information, we can use what is called a <strong>Regular Expression (Regex)</strong> and <strong>string manipulation</strong> tools.</p>
<section id="regex-regular-expression" class="level3">
<h3 class="anchored" data-anchor-id="regex-regular-expression">Regex: Regular expression</h3>
<p>Regular expressions (regex) are used to search for patterns in text strings. Regular expressions are super flexible and very powerful, BUT they can be slightly confusing at times…</p>
<p>Instead of looking for an exact word like <strong>cat</strong>, a <strong>regex</strong> lets you search for things like:</p>
<ul>
<li><p>“Any word that starts with ‘c’ and ends with ‘t’”</p></li>
<li><p>“Any sequence of digits”</p></li>
<li><p>“A word that may or may not have a certain letter”</p></li>
<li><p>“A word containing a specific delimiter, e.g.&nbsp;a dash, as comma, etc.”</p></li>
</ul>
<p>It might look a little weird (lots of slashes, dots, and symbols), but once you learn a few basics, it’s incredibly useful! And the good thing is that ChatCPT is very good at making regular expressions for you!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../figures/regex1.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>We will do string manipulation the tidyverse way: using the <code>stringr</code> package where all the functions starts with <code>str_</code>. These functions often has a parameter called <code>pattern</code> which can take a regular expression as an argument. Let’s start with some simple examples.</p>
</section>
<section id="examples" class="level3">
<h3 class="anchored" data-anchor-id="examples">Examples</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df_ov<span class="sc">$</span>alt_sample_name <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TCGA-20-0987-01A-02R-0434-01"</code></pre>
</div>
</div>
<p>Let’s say we want to extract part of the sample name. We can use the <code>str_split_i</code> function to split a string on a given character and access the i’th element.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split_i</span>(<span class="st">'TCGA-20-0987-01A-02R-0434-01'</span>, <span class="at">pattern =</span> <span class="st">'-'</span>, <span class="at">i =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "20"</code></pre>
</div>
</div>
<p>This grabs the 4th segment in the name string, which might contain the sample code We can apply this to a whole column using <code>mutate()</code> and create a new variable with the extracted values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_code =</span> <span class="fu">str_split_i</span>(alt_sample_name, <span class="at">pattern =</span> <span class="st">'-'</span>, <span class="at">i =</span> <span class="dv">4</span>))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df_ov<span class="sc">$</span>sample_code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
01A 01B 01C 01D 11A 
539  27   2   1   8 </code></pre>
</div>
</div>
<p>We know that <strong>01</strong> encodes <strong>primary tumor</strong> while <strong>11</strong> encodes healthy tissue. We can use <code>str_detect()</code> to see if a sub-string contains the <strong>01</strong> or <strong>11</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(df_ov<span class="sc">$</span>sample_code, <span class="st">'01'</span>) <span class="sc">%&gt;%</span> <span class="fu">table</span>(<span class="at">useNA =</span> <span class="st">'ifany'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
FALSE  TRUE  &lt;NA&gt; 
    8   569     1 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(df_ov<span class="sc">$</span>sample_code, <span class="st">'11'</span>) <span class="sc">%&gt;%</span> <span class="fu">table</span>(<span class="at">useNA =</span> <span class="st">'ifany'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
FALSE  TRUE  &lt;NA&gt; 
  569     8     1 </code></pre>
</div>
</div>
<p>Add a column that records TRUE if sample is a primary tumor and place it after the <code>Sample_type</code> column.</p>
<p><code>'01.{0,1}'</code> explained:</p>
<p><code>01</code> — matches the characters ‘0’ followed immediately by ‘1’.</p>
<p><code>.</code> — matches any single character (A, B, C, X, !, except a newline by default).</p>
<p><code>{0,1}</code> — is a quantifier, meaning: match the preceding element (the dot <code>.</code>) zero or one time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_code_manual =</span> <span class="fu">str_detect</span>(sample_code, <span class="st">'01.{0,1}'</span>), </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">.after =</span> sample_type)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(df_ov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 21
  alt_sample_name  unique_patient_ID sample_type sample_code_manual summarygrade
  &lt;chr&gt;            &lt;chr&gt;             &lt;fct&gt;       &lt;lgl&gt;              &lt;fct&gt;       
1 TCGA-24-1852-01… TCGA-24-1852      tumor       TRUE               high        
2 TCGA-29-1692-01… TCGA-29-1692      tumor       TRUE               low         
3 TCGA-13-1817-01… TCGA-13-1817      tumor       TRUE               high        
4 TCGA-61-1916-01… TCGA-61-1916      tumor       TRUE               low         
5 TCGA-29-1704-01… TCGA-29-1704      tumor       TRUE               high        
6 TCGA-13-1819-01… TCGA-13-1819      unknown     TRUE               high        
# ℹ 16 more variables: summarystage &lt;fct&gt;, tumorstage &lt;fct&gt;, grade &lt;fct&gt;,
#   age_at_initial_path_diagn &lt;int&gt;, recurrence_status &lt;fct&gt;,
#   days_to_death &lt;int&gt;, vital_status &lt;fct&gt;, percent_normal_cells &lt;int&gt;,
#   percent_stromal_cells &lt;int&gt;, percent_tumor_cells &lt;int&gt;, batch &lt;fct&gt;,
#   percent_not_cancer_cells &lt;int&gt;, stage &lt;chr&gt;, dominant_cell_type &lt;chr&gt;,
#   group &lt;chr&gt;, sample_code &lt;chr&gt;</code></pre>
</div>
</div>
<p>We can also replace text patterns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(<span class="st">'TCGA'</span>, <span class="st">'A'</span>, <span class="st">'aaaaaaaaaa'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TCGaaaaaaaaaa"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_recode =</span> <span class="fu">str_replace_all</span>(sample_code, <span class="st">'01.'</span>, <span class="st">'Tumor'</span>),</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">sample_recode =</span> <span class="fu">str_replace_all</span>(sample_recode, <span class="st">'11A'</span>, <span class="st">'Healthy'</span>),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">.after =</span> sample_type)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>df_ov <span class="sc">%&gt;%</span> <span class="fu">select</span>(alt_sample_name, sample_code, sample_code_manual, sample_recode) <span class="sc">%&gt;%</span> <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  alt_sample_name              sample_code sample_code_manual sample_recode
  &lt;chr&gt;                        &lt;chr&gt;       &lt;lgl&gt;              &lt;chr&gt;        
1 TCGA-24-1852-01A-01R-0808-01 01A         TRUE               Tumor        
2 TCGA-29-1692-01B-01R-0808-01 01B         TRUE               Tumor        
3 TCGA-13-1817-01A-01R-0808-01 01A         TRUE               Tumor        
4 TCGA-61-1916-01A-01R-0808-01 01A         TRUE               Tumor        
5 TCGA-29-1704-01B-01R-0808-01 01B         TRUE               Tumor        
6 TCGA-13-1819-01A-01R-0808-01 01A         TRUE               Tumor        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df_ov <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(sample_code_manual, sample_code, alt_sample_name, sample_type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nicely done!</p>
<p><strong>At this point, we have:</strong></p>
<ol type="1">
<li><p>Dropped Variables with Too Many Missing Values</p></li>
<li><p>Fixed Variable Types</p></li>
<li><p>Dropped Non-Informative Variables</p></li>
<li><p>Recoded and Reordered Factors</p></li>
<li><p>Created New Variables from existing ones</p></li>
</ol>
</section>
</section>
<section id="joining-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="joining-dataframes">Joining Dataframes</h2>
<p>Often we have information stored in more than one table, and we want to merge these data together into a single dataset. For example, here we would like to join our <code>df_ov</code> and <code>df_exp</code> data table by IDs.</p>
<p>Let’s make a subset of each of the datasets to have a better overview of what is going on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>df_exp_subset <span class="ot">&lt;-</span> df_exp <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(unique_patient_ID) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>df_ov_subset <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(unique_patient_ID) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>df_exp_subset<span class="sc">$</span>unique_patient_ID <span class="sc">%in%</span> df_ov_subset<span class="sc">$</span>unique_patient_ID <span class="sc">%&gt;%</span> <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
FALSE  TRUE 
    2     3 </code></pre>
</div>
</div>
<p>A quick recap of join types from <code>dplyr</code>:</p>
<ul>
<li><p><code>full_join()</code>: all rows from both</p></li>
<li><p><code>inner_join()</code>: only matched rows</p></li>
<li><p><code>left_join()</code>: all from left, matched from right</p></li>
<li><p><code>right_join()</code>: all from right, matched from left</p></li>
</ul>
<section id="full-join" class="level4">
<h4 class="anchored" data-anchor-id="full-join">Full Join</h4>
<p>A <strong>full join</strong> keeps <em>everything</em> — all rows from both <code>df_ov_subset</code> and <code>df_exp_subset</code>. If there’s no match, missing values (<code>NA</code>) are filled in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df_ov_subset <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(df_exp_subset, <span class="at">by =</span> <span class="st">"unique_patient_ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 9
  unique_patient_ID sample_recode summarygrade summarystage tumorstage CXCL1
  &lt;chr&gt;             &lt;chr&gt;         &lt;fct&gt;        &lt;fct&gt;        &lt;fct&gt;      &lt;dbl&gt;
1 TCGA-01-0631      Healthy       &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;        7.70
2 TCGA-01-0633      Healthy       &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;        5.16
3 TCGA-01-0636      Healthy       &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;        3.27
4 TCGA-01-0637      Healthy       &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;       NA   
5 TCGA-01-0639      Healthy       &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;       NA   
6 TCGA-01-0628      &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;        3.36
7 TCGA-01-0630      &lt;NA&gt;          &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;        3.05
# ℹ 3 more variables: CXCL10 &lt;dbl&gt;, CXCL11 &lt;dbl&gt;, CXCL12 &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="inner-join" class="level4">
<h4 class="anchored" data-anchor-id="inner-join">Inner Join</h4>
<p>An <strong>inner join</strong> keeps only the rows that appear in <strong>both</strong> data frames. So if an ID exists in one but not the other, it’s dropped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>df_ov_subset <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(df_exp_subset, <span class="at">by =</span> <span class="st">"unique_patient_ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="left-join" class="level4">
<h4 class="anchored" data-anchor-id="left-join">Left Join</h4>
<p>A <strong>left join</strong> keeps <strong>all rows from</strong> <code>df_ov_subset</code>, and matches info from <code>df_exp_subset</code> wherever possible. Unmatched rows from <code>df_ov_subset</code> get <code>NA</code> for the new columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df_ov_subset <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_exp_subset, <span class="at">by =</span> <span class="st">"unique_patient_ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 9
  unique_patient_ID sample_recode summarygrade summarystage tumorstage CXCL1
  &lt;chr&gt;             &lt;chr&gt;         &lt;fct&gt;        &lt;fct&gt;        &lt;fct&gt;      &lt;dbl&gt;
1 TCGA-01-0631      Healthy       &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;        7.70
2 TCGA-01-0633      Healthy       &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;        5.16
3 TCGA-01-0636      Healthy       &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;        3.27
4 TCGA-01-0637      Healthy       &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;       NA   
5 TCGA-01-0639      Healthy       &lt;NA&gt;         &lt;NA&gt;         &lt;NA&gt;       NA   
# ℹ 3 more variables: CXCL10 &lt;dbl&gt;, CXCL11 &lt;dbl&gt;, CXCL12 &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="right-join" class="level4">
<h4 class="anchored" data-anchor-id="right-join">Right Join</h4>
<p>A <strong>right join</strong> is the opposite: it keeps <strong>all rows from</strong> <code>df_ov_subset</code> and adds matching data from <code>df_exp_subset</code> wherever it can.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df_ov_subset <span class="sc">%&gt;%</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(df_exp_subset, <span class="at">by =</span> <span class="st">"unique_patient_ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lets-join-our-datasets" class="level3">
<h3 class="anchored" data-anchor-id="lets-join-our-datasets">Let’s join our datasets</h3>
<p>We will join the two full datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df_comb <span class="ot">&lt;-</span> df_ov <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df_exp, <span class="at">by =</span> <span class="st">"unique_patient_ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="recap" class="level3">
<h3 class="anchored" data-anchor-id="recap">Recap</h3>
<p><strong>By now, we have:</strong></p>
<ul>
<li><p>Loaded and explored clinical and expression datasets</p></li>
<li><p>Cleaned whitespace, fixed types, dropped unnecessary variables</p></li>
<li><p>Created new columns through logic and string operations</p></li>
<li><p>Merged the clinical and expression data for downstream analysis</p></li>
<li><p>Your data is now prepped and ready for modeling, visualization, or more advanced statistical analysis.</p></li>
</ul>
<p><strong>Your dataset <code>df_comb</code> is now ready for summary statistics and exploratory data analysis (EDA).</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(df_comb, <span class="at">file=</span><span class="st">"../data/Ovarian_comb_clean.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>